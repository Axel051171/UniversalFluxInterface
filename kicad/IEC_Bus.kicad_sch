(kicad_sch
  (version 20231120)
  (generator "eeschema")
  (generator_version "8.0")
  (uuid "iec-bus-uuid-12345678")
  (paper "A3")
  (title_block
    (title "IEC Bus Interface")
    (date "2026-01-16")
    (rev "0.1")
    (company "UFI Project")
    (comment 1 "XUM1541 Compatible")
    (comment 2 "C64 1541/1571/1581 Support")
  )
  
  (lib_symbols
    ;; DIN-6 IEC Connector
    (symbol "UFI:Conn_IEC_DIN6"
      (pin_names
        (offset 1.016)
      )
      (exclude_from_sim no)
      (in_bom yes)
      (on_board yes)
      (property "Reference" "J"
        (at 0 10.16 0)
        (effects
          (font
            (size 1.27 1.27)
          )
        )
      )
      (property "Value" "IEC_DIN6"
        (at 0 -10.16 0)
        (effects
          (font
            (size 1.27 1.27)
          )
        )
      )
      (property "Footprint" "Connector_DIN:DIN-6_Mini_Female_Horizontal"
        (at 0 0 0)
        (effects
          (font
            (size 1.27 1.27)
          )
          (hide yes)
        )
      )
      (symbol "Conn_IEC_DIN6_0_1"
        (circle
          (center 0 0)
          (radius 7.62)
          (stroke
            (width 0.254)
            (type default)
          )
          (fill
            (type background)
          )
        )
      )
      (symbol "Conn_IEC_DIN6_1_1"
        (pin bidirectional line (at -12.7 5.08 0) (length 5.08) (name "SRQ" (effects (font (size 1.0 1.0)))) (number "1" (effects (font (size 1.0 1.0)))))
        (pin power_in line (at -12.7 0 0) (length 5.08) (name "GND" (effects (font (size 1.0 1.0)))) (number "2" (effects (font (size 1.0 1.0)))))
        (pin bidirectional line (at -12.7 -5.08 0) (length 5.08) (name "ATN" (effects (font (size 1.0 1.0)))) (number "3" (effects (font (size 1.0 1.0)))))
        (pin bidirectional line (at 12.7 5.08 180) (length 5.08) (name "CLK" (effects (font (size 1.0 1.0)))) (number "4" (effects (font (size 1.0 1.0)))))
        (pin bidirectional line (at 12.7 0 180) (length 5.08) (name "DATA" (effects (font (size 1.0 1.0)))) (number "5" (effects (font (size 1.0 1.0)))))
        (pin input line (at 12.7 -5.08 180) (length 5.08) (name "~{RESET}" (effects (font (size 1.0 1.0)))) (number "6" (effects (font (size 1.0 1.0)))))
      )
    )
    
    ;; SN7406 Open-Collector Inverter
    (symbol "UFI:SN7406"
      (pin_names
        (offset 1.016)
      )
      (exclude_from_sim no)
      (in_bom yes)
      (on_board yes)
      (property "Reference" "U"
        (at 0 10.16 0)
        (effects
          (font
            (size 1.27 1.27)
          )
        )
      )
      (property "Value" "SN7406"
        (at 0 7.62 0)
        (effects
          (font
            (size 1.27 1.27)
          )
        )
      )
      (property "Footprint" "Package_SO:SOIC-14_3.9x8.7mm_P1.27mm"
        (at 0 0 0)
        (effects
          (font
            (size 1.27 1.27)
          )
          (hide yes)
        )
      )
      (symbol "SN7406_0_1"
        (rectangle
          (start -7.62 5.08)
          (end 7.62 -7.62)
          (stroke
            (width 0.254)
            (type default)
          )
          (fill
            (type background)
          )
        )
      )
      (symbol "SN7406_1_1"
        (pin power_in line (at 0 10.16 270) (length 5.08) (name "VCC" (effects (font (size 1.0 1.0)))) (number "14" (effects (font (size 1.0 1.0)))))
        (pin power_in line (at 0 -12.7 90) (length 5.08) (name "GND" (effects (font (size 1.0 1.0)))) (number "7" (effects (font (size 1.0 1.0)))))
        (pin input line (at -12.7 2.54 0) (length 5.08) (name "1A" (effects (font (size 1.0 1.0)))) (number "1" (effects (font (size 1.0 1.0)))))
        (pin open_collector line (at 12.7 2.54 180) (length 5.08) (name "1Y" (effects (font (size 1.0 1.0)))) (number "2" (effects (font (size 1.0 1.0)))))
        (pin input line (at -12.7 0 0) (length 5.08) (name "2A" (effects (font (size 1.0 1.0)))) (number "3" (effects (font (size 1.0 1.0)))))
        (pin open_collector line (at 12.7 0 180) (length 5.08) (name "2Y" (effects (font (size 1.0 1.0)))) (number "4" (effects (font (size 1.0 1.0)))))
        (pin input line (at -12.7 -2.54 0) (length 5.08) (name "3A" (effects (font (size 1.0 1.0)))) (number "5" (effects (font (size 1.0 1.0)))))
        (pin open_collector line (at 12.7 -2.54 180) (length 5.08) (name "3Y" (effects (font (size 1.0 1.0)))) (number "6" (effects (font (size 1.0 1.0)))))
        (pin input line (at -12.7 -5.08 0) (length 5.08) (name "4A" (effects (font (size 1.0 1.0)))) (number "9" (effects (font (size 1.0 1.0)))))
        (pin open_collector line (at 12.7 -5.08 180) (length 5.08) (name "4Y" (effects (font (size 1.0 1.0)))) (number "8" (effects (font (size 1.0 1.0)))))
      )
    )
  )
  
  ;; Notes
  (text "IEC Bus (C64 Serial Bus) Interface\n\nSignals:\n- ATN (Attention): Active Low, Open-Collector\n- CLK (Clock): Active Low, Open-Collector  \n- DATA: Active Low, Open-Collector\n- SRQ (Service Request): Active Low\n- RESET: Active Low\n\nElectrical:\n- 5V tolerant with 1kΩ pull-ups\n- SN7406 for open-collector drive (30V/40mA sink)\n- SN7407 alternative (non-inverting)\n\nXUM1541 Compatibility:\n- Same protocol as OpenCBM/xu1541\n- Supports nibbler/parallel protocols\n- Works with 1541, 1571, 1581, FD-2000/4000\n\nConnection:\n  MCU (3.3V)          7406           IEC Bus (5V)\n  ─────────────────────────────────────────────\n  PD0/IEC_ATN_OUT ──→ 1A ─→ 1Y ──→ ATN (pin 3)\n  PD1/IEC_CLK_OUT ──→ 2A ─→ 2Y ──→ CLK (pin 4)\n  PD2/IEC_DATA_OUT ─→ 3A ─→ 3Y ──→ DATA (pin 5)\n  \n  ATN_IN ←───────── Schmitt ←───── ATN\n  CLK_IN ←───────── Schmitt ←───── CLK\n  DATA_IN ←──────── Schmitt ←───── DATA"
    (exclude_from_sim no)
    (at 25.4 38.1 0)
    (effects
      (font
        (size 1.5 1.5)
      )
      (justify left top)
    )
    (uuid "text-iec-notes")
  )
  
  ;; Hierarchical Labels
  (hierarchical_label "IEC_ATN_OUT"
    (shape output)
    (at 25.4 139.7 180)
    (effects
      (font
        (size 1.27 1.27)
      )
      (justify right)
    )
    (uuid "hlabel-iec-atn-out")
  )
  
  (hierarchical_label "IEC_CLK_OUT"
    (shape output)
    (at 25.4 144.78 180)
    (effects
      (font
        (size 1.27 1.27)
      )
      (justify right)
    )
    (uuid "hlabel-iec-clk-out")
  )
  
  (hierarchical_label "IEC_DATA_OUT"
    (shape output)
    (at 25.4 149.86 180)
    (effects
      (font
        (size 1.27 1.27)
      )
      (justify right)
    )
    (uuid "hlabel-iec-data-out")
  )
  
  (hierarchical_label "IEC_SRQ_OUT"
    (shape output)
    (at 25.4 154.94 180)
    (effects
      (font
        (size 1.27 1.27)
      )
      (justify right)
    )
    (uuid "hlabel-iec-srq-out")
  )
  
  (hierarchical_label "IEC_ATN_IN"
    (shape input)
    (at 228.6 139.7 0)
    (effects
      (font
        (size 1.27 1.27)
      )
      (justify left)
    )
    (uuid "hlabel-iec-atn-in")
  )
  
  (hierarchical_label "IEC_CLK_IN"
    (shape input)
    (at 228.6 144.78 0)
    (effects
      (font
        (size 1.27 1.27)
      )
      (justify left)
    )
    (uuid "hlabel-iec-clk-in")
  )
  
  (hierarchical_label "IEC_DATA_IN"
    (shape input)
    (at 228.6 149.86 0)
    (effects
      (font
        (size 1.27 1.27)
      )
      (justify left)
    )
    (uuid "hlabel-iec-data-in")
  )
  
  (hierarchical_label "IEC_RESET"
    (shape output)
    (at 25.4 165.1 180)
    (effects
      (font
        (size 1.27 1.27)
      )
      (justify right)
    )
    (uuid "hlabel-iec-reset")
  )
)
